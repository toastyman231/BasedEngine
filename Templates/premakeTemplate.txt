include "project-dependencies.lua"

workspace "PROJ_NAME"
    startproject "PROJ_NAME"
    architecture "x64"

    configurations
    {
        "Debug",
        "Release"
    }

tdir = "bin/%{cfg.buildcfg}/%{prj.name}"
odir = "bin-obj/%{cfg.buildcfg}/%{prj.name}"

group "Engine"
    include "ENGINE_LOCATION\based"
group ""

group "Projects"
    project "PROJ_NAME"
        kind "ConsoleApp"
        language "C++"
        cppdialect "C++17"
        staticruntime "on"
        links "based"

        targetdir(tdir)
        objdir(odir)

        files 
        {
            "src/**.h",
            "src/**.cpp"
        }

        includedirs
        {
            "ENGINE_LOCATION\based\include",
            "ENGINE_LOCATION\%{IncludeDirs.spdlog}",
            "ENGINE_LOCATION\%{IncludeDirs.rmlui}",
            "ENGINE_LOCATION\%{IncludeDirs.tracy}",
            "ENGINE_LOCATION\%{IncludeDirs.yaml_cpp}"
        }

        flags
        {
            "FatalWarnings"
        }

        postbuildcommands
        {
            "python3 " .. string.sub(path.getabsolute("%{prj.name}"), 1, string.len(path.getabsolute("%{prj.name}")) - (string.len("%{prj.name}") + 1)) .. "/postbuild.py config=%{cfg.buildcfg} prj=%{prj.name}"
        }   

        filter {"system:windows", "configurations:Debug"}
            systemversion "latest"

            defines
            {
                "BASED_PLATFORM_WINDOWS"
            }

        filter {"system:windows", "configurations:Release"}
            systemversion "latest"

            defines
            {
                "BASED_PLATFORM_WINDOWS"
            }

        filter {"system:macosx", "configurations:*"}
            xcodebuildsettings
            {
                ["MACOSX_DEPLOYMENT_TARGET"] = "10.15",
                ["UseModernBuildSystem"] = "NO"
            }

            defines
            {
                "BASED_PLATFORM_MAC"
            }

            abspath = path.getabsolute("%{IncludeDirs.maclibs}")
            linkoptions {"-F " .. abspath}

        filter {"system:linux", "configurations:*"}
            defines
            {
                "BASED_PLATFORM_LINUX"
            }

        filter "configurations:Debug"
            defines
            {
                "BASED_CONFIG_DEBUG"
            }
            runtime "Debug"
            symbols "on"

        filter "configurations:Release"
            defines
            {
                "BASED_CONFIG_RELEASE"
            }
            runtime "Release"
            symbols "off"
            optimize "on"
group""